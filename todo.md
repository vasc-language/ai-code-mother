# 个人主页功能需求文档

## 功能概述

为AI代码生成平台增加个人主页功能,用户可以查看和编辑个人信息、查看自己创建的应用列表、统计数据等。该功能旨在提升用户体验，增强用户对平台的归属感和使用粘性。

---

## 需求背景

### 业务价值
- **用户体验提升**：提供统一的个人信息管理入口
- **数据可视化**：展示用户使用情况和成就
- **社交元素**：为未来的社交功能（如关注、分享）预留接口
- **留存提升**：通过数据展示增强用户成就感

### 用户痛点
1. 当前系统缺少个人信息管理界面
2. 用户无法直观查看自己创建的所有应用
3. 缺少使用统计数据，用户无法了解自己的使用情况
4. 头像和个人简介修改不便

---

## 功能详细设计

### 1. 个人主页入口

**位置**：全局导航栏右上角用户区域

**入口方式**：
- 点击用户头像下拉菜单中的"个人主页"选项
- 路由路径：`/user/profile/:userId` (支持查看他人主页) 或 `/user/profile` (查看自己主页)

---

### 2. 页面布局设计

#### 2.1 顶部用户信息卡片
展示用户的基本信息，采用卡片式设计

**包含内容**：
- **用户头像**：圆形头像，支持点击放大预览
- **用户昵称**：大字号显示，突出显示
- **账号ID**：小字号灰色文字
- **用户简介**：多行文本，最多显示3行，超出显示省略号
- **注册时间**：显示格式如"加入于 2025年1月"
- **用户角色标识**：普通用户/管理员徽章
- **编辑按钮**：仅查看自己主页时显示，点击进入编辑模式

#### 2.2 统计数据面板
使用Ant Design的Statistic组件展示关键数据

**统计维度**：
- **创建应用数**：用户创建的应用总数
- **生成次数**：AI代码生成的总次数
- **累计使用天数**：从注册到现在的天数
- **最近活跃**：最后一次使用AI生成的时间（如"3天前"）

#### 2.3 我的应用列表
展示用户创建的所有应用

**列表功能**：
- **应用卡片**：展示应用名称、描述、创建时间、生成类型
- **排序选项**：
  - 最近创建
  - 最近使用
  - 应用名称
- **筛选选项**：
  - 全部应用
  - 按生成类型筛选（HTML/多文件项目/Vue应用）
- **操作按钮**：
  - 使用应用（跳转到聊天页面）
  - 编辑应用
  - 删除应用（仅自己的应用可删除）
- **分页**：每页显示10个应用，支持翻页
- **空状态提示**：暂无应用时显示引导创建按钮

#### 2.4 Tab标签页（预留扩展）
使用Ant Design Tabs组件组织内容

**当前版本Tab**：
- **我的应用**（默认）
- **统计概览**（未来扩展：图表化展示使用趋势）

**未来扩展Tab**：
- 收藏的应用
- 使用历史
- 成就勋章

---

### 3. 个人信息编辑功能

#### 3.1 编辑模式触发
- 点击"编辑资料"按钮进入编辑模式
- 页面切换为表单编辑状态

#### 3.2 可编辑字段
- **用户昵称**：文本输入框，长度限制2-20字符
- **用户头像**：
  - 方式1：输入图片URL
  - 方式2：上传图片到腾讯云COS（推荐）
  - 支持预览功能
- **用户简介**：多行文本框，长度限制0-200字符
- **字数统计**：实时显示已输入字符数

#### 3.3 表单验证规则
- 昵称：必填，2-20字符，不允许特殊字符
- 头像URL：选填，必须是有效的URL格式
- 简介：选填，最多200字符

#### 3.4 操作按钮
- **保存修改**：提交更新请求，成功后刷新页面数据
- **取消编辑**：退出编辑模式，恢复原始数据
- **重置密码**：跳转到密码修改页面（未来扩展）

---

### 4. 权限控制

#### 4.1 查看权限
- **自己的主页**：所有内容可见，显示编辑按钮
- **他人主页**：仅显示公开信息（头像、昵称、简介、公开应用），不显示编辑按钮

#### 4.2 编辑权限
- 仅用户本人可编辑自己的信息
- 管理员可以查看所有用户主页，但不能直接编辑（通过用户管理页面编辑）

#### 4.3 数据权限
- 应用列表：仅显示用户自己创建的应用（userId匹配）
- 统计数据：基于用户自己的数据计算

---

## 技术实现方案

### 后端开发任务

#### 1. 数据库层（无需修改）
当前`user`表已包含所需字段，无需新增表或字段：
- `id`, `userAccount`, `userName`, `userAvatar`, `userProfile`, `userRole`, `createTime`

#### 2. 接口层开发

##### 2.1 获取用户主页信息
```
GET /api/user/profile/{userId}
```
**功能**：获取指定用户的主页信息和统计数据

**响应数据**：
```json
{
  "code": 0,
  "data": {
    "user": {
      "id": 123,
      "userAccount": "join2049",
      "userName": "Join",
      "userAvatar": "https://...",
      "userProfile": "这是我的个人简介",
      "userRole": "user",
      "createTime": "2025-01-15T10:30:00"
    },
    "statistics": {
      "appCount": 15,
      "generateCount": 88,
      "joinDays": 45,
      "lastActiveTime": "2025-03-01T14:20:00"
    }
  },
  "message": "ok"
}
```

##### 2.2 获取用户应用列表
```
GET /api/user/apps/{userId}?page=1&pageSize=10&sortBy=createTime&genType=all
```
**功能**：获取指定用户创建的应用列表（分页+排序+筛选）

**请求参数**：
- `page`: 页码，默认1
- `pageSize`: 每页数量，默认10
- `sortBy`: 排序字段（createTime/updateTime/name），默认createTime
- `genType`: 生成类型筛选（all/HTML/多文件项目/Vue应用）

**响应数据**：
```json
{
  "code": 0,
  "data": {
    "total": 15,
    "records": [
      {
        "id": 1,
        "name": "我的第一个应用",
        "description": "应用描述",
        "genType": "HTML",
        "createTime": "2025-02-01T10:00:00",
        "updateTime": "2025-02-10T15:30:00"
      }
    ]
  },
  "message": "ok"
}
```

##### 2.3 更新用户信息（已存在，需确认）
```
PUT /api/user/update
```
**功能**：更新当前登录用户的个人信息

**请求体**：
```json
{
  "userName": "新昵称",
  "userAvatar": "https://new-avatar.jpg",
  "userProfile": "新的个人简介"
}
```

#### 3. Service层开发
- `UserService.getUserProfile(Long userId)`: 获取用户主页数据
- `UserService.getUserStatistics(Long userId)`: 计算用户统计数据
- `UserService.getUserApps(Long userId, QueryParams params)`: 获取用户应用列表

---

### 前端开发任务

#### 1. 路由配置
在 `src/router/index.ts` 添加新路由：
```typescript
{
  path: '/user/profile/:userId?',
  name: '个人主页',
  component: UserProfilePage,
}
```

#### 2. 页面组件开发
新建 `src/pages/user/UserProfilePage.vue`

**页面结构**：
```vue
<template>
  <div class="user-profile-page">
    <!-- 用户信息卡片 -->
    <UserInfoCard
      :user="userInfo"
      :editable="isOwnProfile"
      @edit="handleEdit"
    />

    <!-- 统计数据面板 -->
    <StatisticsPanel :statistics="statistics" />

    <!-- Tab标签页 -->
    <a-tabs v-model:activeKey="activeTab">
      <a-tab-pane key="apps" tab="我的应用">
        <!-- 应用列表 -->
        <UserAppsList
          :userId="userId"
          :apps="appsList"
          :total="totalApps"
          @page-change="handlePageChange"
          @sort-change="handleSortChange"
        />
      </a-tab-pane>
    </a-tabs>
  </div>
</template>
```

#### 3. 子组件开发

##### 3.1 `UserInfoCard.vue` - 用户信息卡片
**功能**：
- 显示用户基本信息
- 支持编辑模式切换
- 表单验证和提交

##### 3.2 `StatisticsPanel.vue` - 统计数据面板
**功能**：
- 使用 `<a-statistic>` 展示数字
- 响应式布局（移动端竖向排列）

##### 3.3 `UserAppsList.vue` - 用户应用列表
**功能**：
- 应用卡片展示
- 排序和筛选功能
- 分页控件
- 空状态提示

#### 4. API集成
后端API开发完成后运行 `npm run openapi2ts` 生成TypeScript客户端

#### 5. 状态管理（可选）
在 Pinia store 中缓存用户主页数据，减少重复请求

---

## UI/UX设计要求

### 视觉设计
- **设计风格**：遵循Ant Design设计规范
- **配色方案**：使用系统主题色（蓝色系）
- **响应式设计**：支持移动端和桌面端自适应
- **加载状态**：使用 Skeleton 骨架屏提升体验

### 交互设计
- **编辑模式**：平滑过渡动画，表单验证实时反馈
- **数据更新**：保存成功后显示 Message 提示
- **头像上传**：支持拖拽上传，实时预览
- **空状态**：友好的空状态提示和引导

---

## 数据统计逻辑

### 统计指标计算

#### 1. 创建应用数
```sql
SELECT COUNT(*) FROM app WHERE userId = ? AND isDelete = 0
```

#### 2. 生成次数
需要统计用户所有应用的生成记录，可能需要新增`generation_history`表或从现有日志统计

#### 3. 累计使用天数
```java
long joinDays = ChronoUnit.DAYS.between(user.getCreateTime(), LocalDateTime.now());
```

#### 4. 最近活跃时间
需要记录用户最后一次使用AI生成的时间，可从应用的`updateTime`或聊天记录的`createTime`获取

---

## 测试计划

### 单元测试
- **后端**：Service层方法测试，覆盖统计逻辑和权限控制
- **前端**：关键组件的渲染和交互测试

### 集成测试
- 获取用户主页数据接口测试
- 更新用户信息接口测试
- 应用列表分页、排序、筛选测试

### 功能测试

#### 测试用例
| 用例ID | 测试场景 | 预期结果 |
|-------|---------|---------|
| TC-01 | 查看自己的主页 | 显示完整信息和编辑按钮 |
| TC-02 | 查看他人主页 | 仅显示公开信息，无编辑按钮 |
| TC-03 | 未登录访问主页 | 跳转到登录页面 |
| TC-04 | 编辑用户信息 | 表单验证通过，保存成功 |
| TC-05 | 编辑时输入非法数据 | 显示验证错误提示 |
| TC-06 | 应用列表分页 | 正确加载下一页数据 |
| TC-07 | 应用列表排序 | 按指定字段正确排序 |
| TC-08 | 应用列表筛选 | 仅显示指定类型应用 |
| TC-09 | 删除应用 | 删除后列表更新，统计数减少 |
| TC-10 | 统计数据准确性 | 数字与实际数据一致 |

---

## 开发排期

### 第一阶段：后端开发（2-3天）
- [ ] 设计API接口和响应数据结构
- [ ] 实现用户主页信息查询接口
- [ ] 实现用户应用列表查询接口（含分页/排序/筛选）
- [ ] 实现用户统计数据计算逻辑
- [ ] 完善用户信息更新接口（如已存在则测试验证）
- [ ] 编写单元测试和接口文档

### 第二阶段：前端开发（3-4天）
- [ ] 创建页面路由和基础结构
- [ ] 开发UserInfoCard组件（含编辑模式）
- [ ] 开发StatisticsPanel组件
- [ ] 开发UserAppsList组件
- [ ] 集成后端API（运行openapi2ts）
- [ ] 实现编辑功能和表单验证
- [ ] 响应式布局调整

### 第三阶段：联调测试（1-2天）
- [ ] 前后端联调测试
- [ ] 权限控制验证
- [ ] 边界情况测试
- [ ] 性能优化（缓存、懒加载）
- [ ] UI细节调整

### 第四阶段：上线准备（1天）
- [ ] 代码审查
- [ ] 文档更新（API文档、用户手册）
- [ ] 部署到测试环境
- [ ] 最终验收测试

**预计总工期**：7-10个工作日

---

## 未来扩展方向

### 功能扩展
- **成就系统**：根据使用情况解锁成就徽章
- **数据可视化**：使用图表展示使用趋势
- **社交功能**：关注用户、分享应用
- **活动记录**：展示用户的操作时间线
- **主题定制**：用户自定义主页主题颜色

### 技术优化
- **头像上传优化**：支持裁剪、压缩、多种格式
- **性能优化**：虚拟滚动加载大量应用
- **缓存策略**：Redis缓存统计数据
- **实时更新**：WebSocket推送数据变化

---

## 附录

### 参考页面
- GitHub个人主页：https://github.com/username
- CSDN个人中心：https://i.csdn.net/
- 掘金个人主页：https://juejin.cn/user/xxx

### 相关文档
- Ant Design Vue 组件文档：https://antdv.com/components/overview-cn
- MyBatis-Flex 查询文档：https://mybatis-flex.com/
- Axios 请求文档：https://axios-http.com/

---

## 待办清单

- [ ] **需求确认**：请确认本需求文档是否符合预期
- [ ] **技术方案评审**：确认后端API设计和前端架构
- [ ] **启动开发**：确认后开始第一阶段后端开发

---

## Review（待开发完成后补充）

- 实现功能列表
- 遇到的技术难点和解决方案
- 性能指标和优化效果
- 用户反馈收集