# AppChatPage 布局替换分析报告

## 一、新布局核心特征（来自新文件 722行）

### 1.1 HTML 结构概览

```vue
<template>
  <div class="lovable-app-chat-page">
    <!-- Lovable 风格顶部导航栏 -->
    <header class="lovable-header">
      <div class="header-left">
        <router-link to="/" class="logo-link">
          <img src="/favicon.ico" alt="Logo" class="app-logo" />
        </router-link>
        <div class="app-info">
          <h1 class="app-name">应用名称</h1>
          <span class="code-gen-badge">类型标签</span>
        </div>
      </div>
      <div class="header-actions">
        <!-- 视图切换按钮组 (预览/代码) -->
        <div class="view-toggle-group">...</div>
        <!-- 分隔线 -->
        <div class="header-divider"></div>
        <!-- 操作按钮：详情、历史、下载、部署 -->
        <button class="header-btn">...</button>
        <button class="header-btn header-btn-primary">部署</button>
      </div>
    </header>

    <!-- 主内容区 - 左右分屏布局 -->
    <main class="lovable-main">
      <!-- 左侧：ChatGPT 风格聊天面板 (40% 宽度) -->
      <div class="left-panel chat-panel-container">
        <ChatPanelLovable />
      </div>

      <!-- 中间：可调节分隔条 -->
      <div class="resizer" @mousedown="startResize"></div>

      <!-- 右侧：VS Code 风格代码/预览面板 (60% 宽度) -->
      <div class="right-panel code-panel-container">
        <CodePanelLovable />
      </div>
    </main>
  </div>
</template>
```

### 1.2 新布局关键组件

**新增的 Lovable 风格组件：**
1. `ChatPanelLovable` - 聊天面板组件 (第142行导入)
2. `CodePanelLovable` - 代码/预览面板组件 (第143行导入)

**组件路径：**
```javascript
// 第142-143行
import ChatPanelLovable from './components/lovable/ChatPanelLovable.vue'
import CodePanelLovable from './components/lovable/CodePanelLovable.vue'
```

### 1.3 新布局 CSS 核心样式要点

#### 顶部导航栏样式 (第412-570行)
```css
.lovable-header {
  height: 64px;
  background: linear-gradient(135deg, #fff5f0 0%, #ffe8dd 100%); /* 渐变橙色背景 */
  backdrop-filter: blur(20px);
  box-shadow: 0 4px 20px rgba(255, 107, 53, 0.08);
}

.code-gen-badge {
  background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%); /* 橙色渐变徽章 */
  border-radius: 30px;
  box-shadow: 0 4px 12px rgba(255, 107, 53, 0.35);
}

.view-toggle-group {
  background: white;
  border-radius: 30px; /* 圆角按钮组 */
}

.header-btn-primary {
  background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%); /* 主按钮橙色渐变 */
}
```

#### 主内容区布局 (第572-663行)
```css
.lovable-main {
  flex: 1;
  display: flex; /* 水平分屏布局 */
  overflow: hidden;
}

.left-panel {
  width: 40%; /* 左侧占 40% */
  border-radius: 0 var(--radius-lg) var(--radius-lg) 0; /* 右侧圆角 */
  box-shadow: var(--shadow-md);
}

.resizer {
  width: 8px;
  background: linear-gradient(135deg, rgba(255, 107, 53, 0.08) 0%, rgba(255, 140, 66, 0.12) 100%);
  cursor: col-resize; /* 可调节分隔条 */
}

.right-panel {
  width: 60%; /* 右侧占 60% */
  border-radius: var(--radius-lg) 0 0 var(--radius-lg); /* 左侧圆角 */
  box-shadow: var(--shadow-md);
}
```

#### Lovable 主题变量
```css
/* 第400行导入 */
@import '@/styles/lovable-theme.css';

/* 使用的 CSS 变量： */
--bg-primary, --text-primary, --border-primary
--spacing-xl, --spacing-md, --spacing-sm
--text-lg, --text-sm, --text-xs
--radius-lg, --shadow-md
--z-sticky, --transition-base
--code-bg
```

---

## 二、旧文件业务逻辑需保留区域（来自旧文件 3461行）

### 2.1 核心业务逻辑代码段

| 功能模块 | 行号范围 | 说明 |
|---------|---------|------|
| **imports 和类型定义** | 503-592 | Vue、Router、API、Icon 导入及 Message、GenerationStep、ToolCall 等接口定义 |
| **状态管理和 refs** | 560-710 | appInfo, messages, isGenerating, EventSource 控制、文件生成状态等核心响应式数据 |
| **权限和 AI 头像计算** | 718-743 | isOwner, isAdmin, currentAiAvatar 计算属性 |
| **按钮状态机** | 745-771 | btnState (send/stop/continue/disabled) 和 primaryActionDisabled |
| **对话历史加载** | 877-942 | loadChatHistory, loadMoreHistory 函数 |
| **应用信息获取** | 944-989 | fetchAppInfo 函数 |
| **发送消息和代码生成** | 991-1065 | sendMessage, sendInitialMessage 函数 |
| **SSE 代码生成核心逻辑** | 1067-1432 | generateCode (EventSource 流式响应处理)、onToggleStream (停止/继续) |
| **错误处理** | 1434-1444 | handleError 函数 |
| **预览和下载部署** | 1446-1527 | updatePreview, downloadCode, deployApp |
| **版本管理** | 1529-1618 | showVersionHistory, fetchVersionList, handleRollback |
| **可视化编辑器** | 1670-1701 | toggleEditMode, clearSelectedElement, getInputPlaceholder |
| **流式内容解析** | 1768-2620 | **核心 SSE 解析逻辑** - 包括 HTML、MULTI_FILE、VUE_PROJECT 三种模式的流式处理 |
| **生命周期钩子** | 2623-2726 | onMounted, onUnmounted, watch 路由切换 |

### 2.2 必须保留的核心函数（按重要性排序）

#### 🔴 最高优先级（SSE 代码生成核心）
1. **generateCode** (1068-1362行) - SSE EventSource 连接和流式响应处理
2. **parseStreamingContent** (1981-2018行) - 流式内容总调度器
3. **parseSimpleCodeStreaming** (2249-2300行) - HTML 模式代码解析
4. **parseMultiFileStreaming** (2380-2409行) - MULTI_FILE 模式代码解析
5. **parseFileWriteToolCall** (2021-2048行) - Vue 项目文件写入解析
6. **streamCodeContent** (2133-2211行) - 打字机效果流式输出

#### 🟠 高优先级（用户交互和状态管理）
7. **sendMessage** (1016-1065行) - 发送消息并启动生成
8. **onToggleStream** (1365-1432行) - 停止/继续生成控制
9. **loadChatHistory** (878-937行) - 对话历史加载
10. **fetchAppInfo** (945-989行) - 应用信息获取

#### 🟡 中优先级（内容过滤和UI更新）
11. **filterHtmlContent** (1769-1794行) - HTML 内容过滤
12. **filterOutCodeBlocks** (1797-1836行) - MULTI_FILE 内容过滤
13. **formatVueProjectContent** (1927-1977行) - Vue 项目内容格式化
14. **buildModifyDiffHtml** (1882-1924行) - 文件修改差异对比 HTML 生成

#### 🟢 低优先级（辅助功能）
15. **downloadCode** (1464-1499行) - 代码下载
16. **deployApp** (1502-1527行) - 应用部署
17. **toggleEditMode** (1671-1689行) - 可视化编辑模式切换
18. **版本管理相关函数** (1530-1604行)

### 2.3 全局状态管理（需保留）

```javascript
// 第558行 - 必须保留
const appGenerationStore = useAppGenerationStore()

// 第598-604行 - EventSource 控制状态
const currentRunId = ref<string | null>(null)
const stoppedByUser = ref(false)
const lastUserMessage = ref('')
const currentAiMessageIndex = ref<number | null>(null)
const lastStoppedAt = ref<number>(0)

// 第606-618行 - SSE 批处理优化
let ssePendingChunks: string[] = []
let sseFullContent = ''
const sseFlushTimer = ref<any>(null)
const clearSseTimerAndBuffers = () => { ... }

// 第620-638行 - SSE 性能指标
let sseMetrics: { ... } = { ... }

// 第640-710行 - 代码生成文件状态
const currentGeneratingFile = ref<GeneratedFile | null>(null)
const completedFiles = ref<GeneratedFile[]>([])
const simpleCodeFile = ref<GeneratedFile | null>(null)
const multiFiles = ref<GeneratedFile[]>([])
const multiFileContents = ref<Record<string, string>>({})
```

### 2.4 工具函数（需保留）

```javascript
// 第1746-1766行 - 文件名和语言检测
const extractFileName = (filePath: string): string => { ... }
const detectLanguage = (filePath: string): string => { ... }

// 第1838-1879行 - HTML 转义和 LCS 差异算法
const escapeHtml = (s: string): string => { ... }
const diffLines = (oldStr: string, newStr: string): DiffOp[] => { ... }

// 第1606-1617行 - 日期格式化
const formatDateTime = (dateTime: string | undefined) => { ... }
```

---

## 三、详细替换步骤清单

### 阶段一：创建 composables 文件（新建）

新布局使用了模块化的 composables，需要将旧文件的业务逻辑拆分到以下文件：

#### 1. `useAppInfo.ts` (第128行导入)
**负责：** 应用信息管理
**从旧文件提取：**
- appInfo, appId, isOwner, currentAiAvatar 相关逻辑 (560-562, 718-743行)
- fetchAppInfo 函数 (945-989行)
- formatCodeGenType 辅助函数 (旧文件第519行)

#### 2. `useChatMessages.ts` (第129行导入)
**负责：** 聊天消息管理
**从旧文件提取：**
- messages, userInput, hasMoreHistory, loadingHistory 状态 (593-596, 681-684行)
- loadChatHistory, addUserMessage, addAiMessagePlaceholder, updateAiMessage 函数 (878-937行)
- scrollToBottom 函数 (1457-1461行)

#### 3. `useCodeGeneration.ts` (第130行导入) ⭐⭐⭐ **最核心**
**负责：** SSE 代码生成逻辑
**从旧文件提取：**
- isGenerating, generationFinished, simpleCodeFile, multiFiles 等状态 (594, 690, 664-674行)
- **generateCode 完整函数** (1068-1362行)
- **所有流式解析函数** (1981-2620行)
- **所有内容过滤函数** (1769-1977行)
- currentRunId, stoppedByUser, ssePendingChunks 等 SSE 控制状态 (598-638行)
- startCodeGeneration, stopGeneration, cleanup 抽象接口

#### 4. `useAppDeployment.ts` (第131行导入)
**负责：** 部署和下载管理
**从旧文件提取：**
- downloading, deploying, deployModalVisible, deployUrl 状态 (693-695, 706行)
- downloadCode 函数 (1464-1499行)
- deployApp 函数 (1502-1527行)

#### 5. `useVisualEditor.ts` (第132行导入)
**负责：** 可视化编辑器
**从旧文件提取：**
- isEditMode, selectedElementInfo, visualEditor 实例 (709-715行)
- toggleEditMode, clearSelectedElement 函数 (1671-1693行)
- getInputWithElementContext, afterMessageSent 抽象接口 (旧文件 1022-1047行的逻辑)

### 阶段二：创建内容过滤工具文件（新建）

#### 6. `utils/contentFilters.ts` (第135-139行导入)
**从旧文件提取：**
- filterHtmlContent 函数 (1769-1794行)
- filterOutCodeBlocks 函数 (1797-1836行)
- formatVueProjectContent 函数 (1927-1977行)
- escapeHtml 辅助函数 (1839-1846行)
- diffLines 辅助函数 (1849-1879行)
- buildModifyDiffHtml 函数 (1882-1924行)

### 阶段三：合并主文件 script setup

#### 7. 主文件 `<script setup>` 部分 (第114-396行)

**保留新文件的结构，插入旧文件逻辑：**

```javascript
// 新文件已有的导入 (115-146行)
import { ref, computed, onMounted, onUnmounted } from 'vue'
import { useRoute } from 'vue-router'
import { message } from 'ant-design-vue'
import { ...Icons } from '@ant-design/icons-vue'
import { useAppInfo } from './composables/useAppInfo'
import { useChatMessages } from './composables/useChatMessages'
import { useCodeGeneration } from './composables/useCodeGeneration'
import { useAppDeployment } from './composables/useAppDeployment'
import { useVisualEditor } from './composables/useVisualEditor'
import { filterHtmlContent, ... } from './utils/contentFilters'
import ChatPanelLovable from './components/lovable/ChatPanelLovable.vue'
import CodePanelLovable from './components/lovable/CodePanelLovable.vue'
import { useLoginUserStore } from '@/stores/loginUser'

// ✅ 需要补充的导入（从旧文件）
import { useAppGenerationStore } from '@/stores/appGeneration' // 旧558行
import { VisualEditor } from '@/utils/visualEditor' // 旧535行（如果 useVisualEditor 没有封装）
import request from '@/request' // 旧520行
import { API_BASE_URL, getStaticPreviewUrl } from '@/config/env' // 旧534行

const route = useRoute()
const loginUserStore = useLoginUserStore()

// ========== 应用信息 ==========
const { appInfo, appId, isOwner, currentAiAvatar, fetchAppInfo } = useAppInfo()

// ========== 聊天消息 ==========
const { messages, userInput, ... } = useChatMessages()

// ========== 代码生成 ==========
const { isGenerating, generationFinished, ... } = useCodeGeneration()

// ========== 部署管理 ==========
const { downloading, deploying, ... } = useAppDeployment()

// ========== 可视化编辑器 ==========
const { isEditMode, selectedElementInfo, ... } = useVisualEditor()

// ========== UI 状态 ==========
const currentView = ref<'preview' | 'code'>('preview') // 新文件第203行

// ========== 按钮状态 ==========
// ✅ 需要从旧文件补充 btnState 状态机逻辑 (745-771行)
type BtnState = 'send' | 'stop' | 'continue' | 'disabled'
const btnState = computed<BtnState>(() => {
  if (!isOwner.value) return 'disabled'
  if (isGenerating.value) return 'stop'
  const hasInput = !!(userInput.value && userInput.value.trim())
  if (stoppedByUser.value) {
    if (hasInput) return 'send'
    if (lastUserMessage.value && currentAiMessageIndex.value !== null) return 'continue'
    return 'disabled'
  }
  return hasInput ? 'send' : 'disabled'
})

// ========== 事件处理 ==========
// 保留新文件的简化版本，必要时增强
const sendMessage = async () => {
  // ✅ 合并旧文件 1016-1065行 的完整逻辑
  // 包括：可视化编辑器元素上下文增强、SSE 生成启动
}

// ========== 分隔栏调整 ==========
// 保留新文件 341-372行

// ========== 生命周期 ==========
onMounted(async () => {
  await fetchAppInfo()
  await loadChatHistory(...)

  // ✅ 补充旧文件 2624-2656行 的逻辑
  // - 恢复生成状态（如果有正在进行的任务）
  // - iframe 消息监听
  // - beforeunload 事件监听
})

onUnmounted(() => {
  cleanupCodeGeneration()

  // ✅ 补充旧文件 2658-2676行 的清理逻辑
  // - 清理定时器
  // - 不关闭 EventSource（由全局 store 管理）
})

// ✅ 补充旧文件 2679-2726行 的路由监听
watch(
  () => route.params.id,
  async (newId, oldId) => { ... }
)
```

### 阶段四：替换 template 部分

#### 8. HTML 模板完全替换

**操作：** 将新文件的 `<template>` (1-112行) 完全替换旧文件的 `<template>` (1-500行)

**关键变更点：**
- ✅ 移除旧的 `.header-bar` 结构 → 使用新的 `.lovable-header`
- ✅ 移除旧的 `.main-content` → 使用新的 `.lovable-main` 三栏布局
- ✅ 移除旧的 `.chat-section` 和 `.code-generation-section` → 使用 `ChatPanelLovable` 和 `CodePanelLovable` 组件
- ✅ 保留旧文件的弹窗组件（379-499行）：
  - `<AppDetailModal>` (380-386行)
  - `<DeploySuccessModal>` (389-393行)
  - 版本历史弹窗 (396-499行)

**最终 template 结构：**
```vue
<template>
  <div class="lovable-app-chat-page">
    <!-- 新：Lovable 风格 header -->
    <header class="lovable-header">...</header>

    <!-- 新：左右分屏 main -->
    <main class="lovable-main">
      <div class="left-panel"><ChatPanelLovable /></div>
      <div class="resizer"></div>
      <div class="right-panel"><CodePanelLovable /></div>
    </main>

    <!-- 旧：保留弹窗组件 -->
    <AppDetailModal />
    <DeploySuccessModal />
    <a-modal>版本历史</a-modal>
    <a-modal>版本详情</a-modal>
  </div>
</template>
```

### 阶段五：替换 style 部分

#### 9. CSS 样式完全替换

**操作：** 将新文件的 `<style scoped>` (398-721行) 完全替换旧文件的 `<style scoped>` (2729-3458行)

**保留旧文件的特殊样式：**
- **工具步骤区域样式** (2863-3022行) - 如果 ChatPanelLovable 内部需要显示工具调用信息
- **版本管理样式** (3405-3457行)
- **可视化编辑器元素样式** (3305-3404行)

**最终 style 结构：**
```vue
<style scoped>
/* 新文件完整样式 (398-721行) */
@import '@/styles/lovable-theme.css';

.lovable-app-chat-page { ... }
.lovable-header { ... }
.lovable-main { ... }
.left-panel, .right-panel, .resizer { ... }
响应式设计 { ... }

/* 旧文件保留样式（选择性）*/
.version-item { ... }
.version-info { ... }
.edit-mode-active { ... }
.selected-element-alert { ... }
</style>
```

---

## 四、关键难点和注意事项

### 4.1 SSE 代码生成逻辑迁移 ⚠️

**难点：** 旧文件的 `generateCode` 函数（1068-1362行）高度依赖：
- `appGenerationStore.eventSource` 全局 EventSource 管理
- `parseStreamingContent` 流式解析调度
- 三种模式的内容过滤（HTML、MULTI_FILE、VUE_PROJECT）

**解决方案：**
1. 在 `useCodeGeneration` composable 中封装完整的 SSE 逻辑
2. 保持 `appGenerationStore` 的全局状态管理
3. 确保 `parseStreamingContent` 及其所有子函数（`parseSimpleCodeStreaming`、`parseMultiFileStreaming` 等）都迁移到 composable 中

### 4.2 组件间数据传递 ⚠️

**难点：** `ChatPanelLovable` 和 `CodePanelLovable` 需要访问大量状态

**新文件已传递的 props：**

**ChatPanelLovable 接收：**
```vue
<ChatPanelLovable
  :messages="messages"
  :hasMoreHistory="hasMoreHistory"
  :loadingHistory="loadingHistory"
  :userAvatar="loginUserStore.loginUser.userAvatar"
  :aiAvatar="currentAiAvatar"
  :selectedElementInfo="selectedElementInfo"
  v-model:userInput="userInput"
  :isOwner="isOwner"
  :isGenerating="isGenerating"
  :primaryActionDisabled="primaryActionDisabled"
  :primaryActionTitle="primaryActionTitle"
  @load-more="loadMoreHistory"
  @clear-selected-element="clearSelectedElement"
  @primary-action="onPrimaryActionClick"
  @keydown="onInputKeydown"
/>
```

**CodePanelLovable 接收：**
```vue
<CodePanelLovable
  :currentView="currentView"
  :codeGenType="appInfo?.codeGenType"
  :showPreview="generationFinished"
  :previewUrl="previewUrl"
  :simpleCodeFile="simpleCodeFile"
  :multiFiles="completedFiles"
  :activeFileKey="activeFileKey"
  :generationFinished="generationFinished"
  @preview-loaded="onPreviewLoaded"
  @update:activeFileKey="activeFileKey = $event"
/>
```

**需要补充传递的数据：**
- `currentGeneratingFile` - 当前生成中的文件（Vue 项目模式）
- `isEditMode` - 可视化编辑模式状态
- `toggleEditMode` - 切换编辑模式的回调

### 4.3 全局 store 状态同步 ⚠️

**旧文件的关键逻辑（828-875行）：**
```javascript
// 同步UI状态到全局store
const syncUIStateToStore = () => {
  if (!appGenerationStore.isGenerating) return
  appGenerationStore.updateUIState({
    messages: messages.value,
    currentAiMessageIndex: currentAiMessageIndex.value,
    lastUserMessage: lastUserMessage.value,
    completedFiles: completedFiles.value,
    currentGeneratingFile: currentGeneratingFile.value,
    simpleCodeFile: simpleCodeFile.value,
    multiFiles: multiFiles.value,
    currentMultiFile: currentMultiFile.value,
    multiFileContents: multiFileContents.value,
    generationFinished: generationFinished.value,
  })
}

// 从全局store恢复UI状态
const restoreUIStateFromStore = () => { ... }
```

**解决方案：**
在 `useCodeGeneration` composable 中实现这两个函数，确保页面切换时生成状态不丢失

### 4.4 响应式布局测试 ⚠️

**新文件的响应式设计（666-714行）：**
- 1024px 以下：左右各占 50%，隐藏按钮文字
- 768px 以下：切换为上下布局，resizer 变为水平拖动

**需要测试：**
- 移动端上下拖动分隔条功能
- ChatPanelLovable 和 CodePanelLovable 在小屏幕下的适配

---

## 五、替换执行顺序建议

### 第一步：创建 composables（优先级从高到低）

1. ✅ **创建 `useCodeGeneration.ts`** (最核心，先完成)
   - 迁移所有 SSE 相关逻辑
   - 迁移所有流式解析函数
   - 迁移所有内容过滤函数

2. ✅ **创建 `utils/contentFilters.ts`** (辅助 useCodeGeneration)
   - 导出 filterHtmlContent、filterOutCodeBlocks、formatVueProjectContent

3. ✅ **创建 `useChatMessages.ts`**
   - 迁移消息管理逻辑

4. ✅ **创建 `useAppInfo.ts`**
   - 迁移应用信息管理

5. ✅ **创建 `useAppDeployment.ts`**
   - 迁移部署和下载逻辑

6. ✅ **创建 `useVisualEditor.ts`**
   - 迁移可视化编辑器逻辑

### 第二步：创建 Lovable 组件

7. ✅ **创建 `ChatPanelLovable.vue`**
   - 参考旧文件的 `.chat-section` 结构（2777-3023行）
   - 使用新的 Lovable 样式

8. ✅ **创建 `CodePanelLovable.vue`**
   - 参考旧文件的 `.code-generation-section` 结构（3068-3260行）
   - 根据 `currentView` 切换代码/预览视图

### 第三步：合并主文件

9. ✅ **替换 `AppChatPage.vue` 的 template**
   - 使用新文件的 1-112行
   - 保留旧文件的弹窗组件 (379-499行)

10. ✅ **替换 `AppChatPage.vue` 的 script**
    - 使用新文件的结构框架
    - 补充旧文件的 btnState、路由监听、生命周期逻辑

11. ✅ **替换 `AppChatPage.vue` 的 style**
    - 使用新文件的 398-721行
    - 选择性保留旧文件的特殊样式（版本管理、可视化编辑器）

### 第四步：测试和调试

12. ✅ **功能测试**
    - SSE 代码生成（HTML、MULTI_FILE、VUE_PROJECT 三种模式）
    - 停止/继续生成
    - 可视化编辑器元素选择
    - 预览/代码视图切换
    - 分隔条拖动调整
    - 版本管理和回滚

13. ✅ **样式测试**
    - Lovable 主题效果
    - 响应式布局（1024px、768px 断点）
    - 移动端适配

---

## 六、风险评估和回滚计划

### 高风险点

1. **SSE 代码生成中断** - 如果迁移不完整，可能导致代码生成功能失效
   - **回滚方案：** 保留旧文件备份，快速恢复

2. **全局 store 状态丢失** - 页面切换后生成状态无法恢复
   - **回滚方案：** 确保 `syncUIStateToStore` 和 `restoreUIStateFromStore` 逻辑完整迁移

3. **组件通信失败** - ChatPanelLovable/CodePanelLovable 无法正确接收/发送数据
   - **回滚方案：** 先用简化版组件测试，逐步增加 props 和 events

### 建议

- 每个 composable 创建后立即单元测试
- 分支开发，主分支保留旧代码
- 使用 feature toggle，可以在新旧布局之间切换

---

## 七、总结

### 新布局优势

✅ **模块化架构** - composables 分离关注点，易于维护
✅ **Lovable 主题** - 现代化的渐变橙色设计，视觉冲击力强
✅ **左右分屏** - ChatGPT 风格聊天 + VS Code 风格代码编辑
✅ **可调节分隔条** - 用户可自定义左右面板宽度
✅ **组件化** - ChatPanelLovable/CodePanelLovable 可复用

### 需要保留的旧逻辑（核心价值）

⚠️ **SSE 代码生成引擎** - 1068-2620行，支持三种模式的流式解析
⚠️ **全局 store 状态管理** - 确保页面切换时生成不中断
⚠️ **内容过滤算法** - HTML、MULTI_FILE、VUE_PROJECT 的专用过滤器
⚠️ **可视化编辑器** - 元素选择和上下文增强提示词
⚠️ **版本管理** - 历史版本查看和回滚

### 预估工作量

| 阶段 | 预估时间 |
|------|---------|
| 创建 6 个 composables | 8-12 小时 |
| 创建 2 个 Lovable 组件 | 6-8 小时 |
| 合并主文件 | 4-6 小时 |
| 测试和调试 | 6-10 小时 |
| **总计** | **24-36 小时** |

---

**生成时间：** 2025-10-11
**分析对象：** AppChatPage.vue (新 722行) vs AppChatPage.old-optimized.vue (旧 3461行)
